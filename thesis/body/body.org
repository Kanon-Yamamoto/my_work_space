#+OPTIONS: ^:{}
#+STARTUP: indent nolineimages overview num
#+TITLE: デジタル版しおりの開発
#+AUTHOR: 山本果音
#+LANGUAGE: jp
#+OPTIONS: ^:{}
#+LATEX_HEADER: \renewcommand{\bibname}
* 序論
修学旅行などのイベントでは,参加者に対して事前にしおりが配布されることが多い.
しおりは旅程の把握や所持品の確認,集合時間の共有などを目的とした重要な情報媒体であり,
旅行の準備や当日の行動において欠かせない役割を果たしている.
近年では,スマートフォンの普及により,紙媒体に代わってWebサービスを活用した旅行データの閲覧・共有の
ニーズが高まっており,「旅しお」[1]のようなWebアプリも登場している.
しかし,これらのサービスにはいくつかの課題が存在する.

1つ目は,旅行名や説明文に対するキーワード検索機能が存在しないため,ユーザーはスクロール操作によって目的のしおりを探す必要がある点である.

2つ目は,地図表示機能がないため,目的地の位置関係や全体像を視覚的に理解することが難しく,利用者は外部ツールや手作業で補完しなければならない.

3つ目は, 移動時間の自動算出機能が存在しないため, 各目的地間の所要時間をユーザー自身が都度手動で調べる必要がある点である. これにより, 旅行全体のスケジュールを立てる際に手間がかかり, 計画の精度や効率性が低下する可能性がある.

これらの課題は,旅行計画の際にユーザーにとって大きな障壁となっており,データの整理や視覚的な理解の低下が考えられる.
そこで本研究では,視覚的な理解と効率的に旅行計画を行える「デジタル版しおり」として機能する旅行アプリの開発を目指す.

* 手法
** 開発手法
本研究では,限られた開発期間内で効率的に成果を上げるために,機能ごとに優先順位を設定し,それぞれについて計画・設計・実装・テストの工程を小刻みに繰り返す手法を採用した.
各段階で得られた知見や, 研究室内のメンバーからのフィードバックをもとに, 仕様やUIの見直しを行いながら, 柔軟に改善を重ねた.
これにより, 利用者の視点を反映した機能の追加や調整が可能となり, アプリケーションの完成度と実用性を段階的に高めることができた.

*** Django
開発環境として,Pythonで実装されたサーバーサイドWebアプリケーションフレームワークであるDjangoを選定した[2].Djangoを選定した理由は以下の3つである.

1つ目は,ユーザー認証や管理画面,データベース操作などの機能が初期状態で組み込まれており,追加設定を行わずとも迅速に開発を開始できる点である.これにより,開発初期の環境構築にかかる時間を大幅に削減することが可能となった.

2つ目は,データベース操作をすべてPythonで記述できるため,学習コストが低い点である.Djangoでは,モデルの定義からマイグレーションの実行までを一貫してPythonで記述できるため,SQLの詳細な知識がなくても複雑なデータ構造の設計や変更が容易に行える.

3つ目は,セキュリティ対策がフレームワークに標準で備わっている点である.Djangoはクロスサイトスクリプティング(XSS)やSQLインジェクションなどの脆弱性に対して,初期状態で対策が施されている.
そのため,開発者が個別にセキュリティ機能を実装する必要がなく,安全性の高いWebアプリケーションを効率的に構築することができた.

また,実装にはPython, HTML, JavaScript, CSSを使用し,UIライブラリとしてはBootstrapを採用した.開発にあたってはCopilot[3]を参照しながら,開発を行った.

* 結果と考察
** [#B] アプリ機能
今回，開発したアプリでは大きく分けて7つの機能を実装した.
それぞれの機能は図3.1の通りである.それぞれの機能について次節以降で記述する.
 #+CAPTION: アプリ機能一覧.
 #+attr_latex: :width 15cm
 file:./fig/app.png


DjangoはMTV（Model–Template–View）アーキテクチャに基づいており,それぞれ「アプリ内で扱うデータの構造を定義し,データベースとの連携を担うモデル層（Model）」「ユーザーの操作に応じて処理を行い,適切なデータを返すビュー層（View）」「HTMLで記述された画面を表示するテンプレート層（Template）」の3つの層に分かれている.
たとえば,旅行作成機能では,テンプレートで旅行タイトル・説明・日付などのテキストフィールドなど表示し,ユーザーが入力したデータをビューが受け取って処理し,モデルとして整形してデータベースに保存する. 保存されたデータは,旅行一覧や詳細ページで再びビューによってデータベースから取得され,テンプレートに渡されてHTML内でデータが表示される. この一連の流れにより,旅行データの作成(Create)・取得(Read)・更新(Update)・削除(Delete)といった基本的なCRUD操作が実現されている.このように DjangoのMTVアーキテクチャは, 機能ごとの責任範囲を明確に分離することで, コードの可読性や再利用性を高めている.


*** [#B] アカウント機能
本アプリケーションでは,ユーザー認証機能としてログイン機能と新規登録機能を実装した.

図3.2に示したとおり,ログイン画面では登録済みのユーザーがユーザー名とパスワードを入力することで,個別の旅行プランやチェックリストにアクセスできるようになっている.
 #+CAPTION: ログイン画面.
 #+attr_latex: :width 10cm
 file:./fig/login.png


一方,まだ登録を行っていないユーザーに対しては,図3.4のように新規登録画面を用意しており,ユーザー名・パスワード・確認用パスワードの3項目を入力することでアカウントを作成できる仕組みとした.
パスワードの確認入力を設けることで,入力ミスによるログイン失敗を防ぎ、ユーザー体験の向上を図っている.
 #+CAPTION: 新規登録画面.
 #+attr_latex: :width 10cm
 file:./fig/registration.png

図3.5に示したとおりログアウト機能も実装しており,ユーザーがログアウト操作を行うと,確認ダイアログが表示されるようになっている.
このダイアログでは「ログアウトしますか？」というメッセージとともに,OKまたはキャンセルの選択肢が提示される.
専用のログアウトページは設けていないが、ユーザーの意図しないログアウトを防ぐための確認ステップを導入することで、操作ミスの抑制とユーザー体験の向上を図っている.
  #+CAPTION: ログアウト画面.
 #+attr_latex: :width 10cm
 file:./fig/logout.png

#+LATEX: \newpage
*** 共有機能
本アプリでは,図3.6に示したとおりユーザーが作成した旅行計画を他者と共有するためのリンク生成機能を実装した.
この機能により,ユーザーはパスワード付きの専用URLを発行し,家族や友人と旅行データを安全かつ手軽に共有できる.
共有リンクの作成時には,ユーザーがあらかじめ用意された選択肢から有効期間を選択できるように設計しており,
設定された期限を過ぎたリンクに対しては,システムが自動的に無効と判断し,アクセスを制限する仕組みを導入している.
#+CAPTION: リンク作成画面.
 #+attr_latex: :width 12cm
 file:./fig/share.png

図3.7に示したとおり,ユーザーがパスワードを入力して共有リンクを作成すると,専用URLが画面上に表示される.
また,ワンクリックでURLをコピーできるボタンを設置しており,手動入力によるミスを防ぎつつ,スムーズな共有を実現している.
コピー完了後には,コピーしましたと表示されるため、操作結果が視覚的に分かりやすく,ユーザーの安心感にもつながっている.
#+CAPTION: 共有URL表示画面.
 #+attr_latex: :width 12cm
 file:./fig/link.png

図3.8のように,このリンクを受け取った相手は,パスワードを入力することで旅行計画の詳細を閲覧できる.
パスワードが正確に入力された場合は共有された旅行画面をみることができる.
#+CAPTION: パスワード入力画面.
 #+attr_latex: :width 12cm
 file:./fig/share_tokyo.png

パスワードが正確に入力されなかった場合は図3.9のようにメッセージが表示される.
 #+CAPTION: パスワード入力画面.
 #+attr_latex: :width 12cm
 file:./fig/wrong.png

観光場所の追加や削除などによりデータを編集した場合でも, リンクが有効期限内であれば常に最新の旅行データが反映されるようになっている.
これにより, 共有先のユーザーも常に最新の旅程を確認でき, 変更内容の伝達漏れを防ぐことができる.

また, データを更新するたびに新たなリンクを作成する必要がないため, 複数のリンクが発生して混乱することもなく, スムーズな共有が可能となっている.


共有された側のユーザーは,図3.10に示したとおり旅行データを閲覧することはできるが,内容の編集はできないように制限している.
これにより,データの改ざんや誤操作を防ぎつつ,安全かつ一方向的な共有を実現している.
#+CAPTION: 共有表示画面.
 #+attr_latex: :width 10cm
 file:./fig/tokyo.png



*** 旅行作成画面
図3.11のような旅行作成画面は，本アプリケーションにおける起点となる機能であり，ユーザーが旅行の基本データを登録するための欠かせないインターフェースである.
この画面を通じて入力されたデータは，以降のスケジュール管理や地図表示，チェックリスト生成など，他の機能と密接に連携する基盤となる.
  #+CAPTION: 旅行作成画面.
 #+attr_latex: :width 12cm
 file:./fig/new_trip.png

*** 旅程の視覚化管理
ユーザーが旅行の全体像や日程ごとの計画を直感的に把握できるよう,複数の視覚化機能を実装した.

まず,図3.12に示したとおり登録された旅行期間に基づいて,各旅行を「予定」「旅行中」「終了」「未定」の4つのステータスに分類し,色分けによって一覧画面上に表示する機能を実装した.
これにより,ユーザーは「どこに行ったか」「これからどこに行くか」といった旅行の進行状況を一目で把握できるようになった.
具体的には,「旅行中」は緑,「予定」は青,「終了」はグレー,「未定」は黄色となっている.
さらに,色だけでなくアイコンを加えることでより視覚的にわかりやすい工夫を行った.
 #+CAPTION: 色とアイコンで視覚的に整理された旅行一覧画面.
 #+attr_latex: :width 15cm
 file:./fig/travel.png

また,旅行詳細画面では,Google Maps API [4]を用いて登録された観光場所を地図上に表示する機能を導入した.
これにより,各観光地の位置関係や移動ルートを視覚的に確認でき,旅行計画全体の構造を把握しやすくなった.

加えて,旅行期間を事前に入力しておくことで,旅行の日数分だけタブを動的に生成する機能を実装した.
旅行に含まれる観光場所を図3.13に示したとおり,「全体」「1日目」「2日目」など日程ごとに切り替えて表示する機能も併せて導入し,ユーザーはタブを操作することで,旅行全体の流れを把握しながら,各日の予定を個別に確認・編集することが可能となった.
これにより, 日程ごとの計画を視覚的に整理しやすくなり,過不足のあるスケジュールや移動の偏りにも気づきやすくなった.
また,編集対象の日付を明確に切り替えられることで,誤操作の防止にもつながっている.

タブの切り替えに連動して,地図上に表示される観光地もその日に対応するもののみに自動で更新されるため,
日程ごとの旅程がより視覚的に管理しやすい設計となっている.
 #+CAPTION: 全体から1日目のタブを押したときの変化.
 #+attr_latex: :width 17cm
 file:./fig/focus_on_date.png

これらの機能により,ユーザーは旅行の計画段階において,旅程を効率的に把握・調整できるようになり、
直感的な旅行プランニングが可能となった.


*** UI設計とスタイルの工夫
 本システムでは,Bootstrap 5.1.3[5]を採用し,ユーザーインターフェースの視覚的理解を促進した.

      観光地データなどの表示にBootstrapのカードコンポーネントを活用し,データの視認性と整理性を高めている.
      カードは,場所データや旅行詳細をカード形式で表示することで,各データのまとまりを視覚的に明確化した.これにより,ユーザーは一目でデータの区切りを理解できる.

      さらにFont Awesome[5]を併用し,ボタンにアイコンを付与することで,言語に依存しない直感的な操作を可能にした.


*** 旅程の編集・調節機能
旅行の計画を柔軟に調整できるよう,旅程編集に関する2つの機能を実装した.

まず,観光場所の訪問順序をドラッグすることで自由に入れ替える機能を導入した.
これにより,ユーザーは移動効率や興味関心に応じて旅程を柔軟に再構成できるようになった.従来のように順序を変更するたびに項目を削除し,再度追加し直す必要がなくなったことで,操作性が向上し,旅程編集の負担が大幅に軽減された.

また図3.14に示したとおり,各観光地間の移動時間を自動で算出・表示する機能を実装した.
算出されるのは車での移動を想定した所要時間であり,ユーザーは移動にかかる時間を考慮しながら,現実的かつ無理のないスケジュールを立てることが可能となった.

これらはMapboxのDirections API[6]を活用して開発を行っている.以下にその処理の流れを示す.

アクティブなタブに表示されている観光地リストから, 各地点の座標（経度・緯度）を配列として取得する.
この配列の先頭を出発地, 末尾を目的地, それ以外を経由地として分割し, Directions API に渡す形式に整形する.
travelDuration(type, start, waypoints, dest) は、Mapbox Directions API を使ってルートデータを取得する関数である.

•type：移動手段（例：driving, walking, cycling）

•start：出発地の座標（{ lon, lat }）

•waypoints：経由地の配列

•dest：目的地の座標

経由地は任意の個数を指定できるため, 配列として管理している.
指定形式に変換した座標データと移動手段をもとに, 以下の形式のURLに対してリクエストを送信する.

https://api.mapbox.com/directions/v5/{profile}/{coordinates} 

に対してリクエストを送信することで,複数地点間の移動時間・距離を一度に取得できる.

・profile: 移動手段を指定するパラメータであり, driving（車）, walking（徒歩）, cycling（自転車）の3種類が用意されている. 本アプリでは driving を使用している.

・coordinates: 出発地・経由地・目的地の座標を「経度,緯度」形式でセミコロン（;）区切りで列挙する.

この形式により, 複数地点間のルートを1回のリクエストでまとめて取得することが可能となる.

APIからのレスポンスには routes 配列が含まれており, 最適なルートが routes[0] に格納されている.
この中の legs 配列には, 各区間（出発地→経由地→目的地）ごとの詳細データが含まれており,それぞれの leg には以下のデータが含まれる.

・duration: 所要時間（秒単位）

・distance: 移動距離（メートル単位）

取得した各区間のデータをもとに, 所要時間は分単位に, 距離はキロメートル単位（小数点1桁）に変換し,
「車 約15分（3.2km）」のような形式で, 観光地カードの間に動的に挿入して表示している.
移動時間が可視化されたことで,訪問地の組み合わせや順序の検討がより直感的かつ効率的に行えるようになった.

 #+CAPTION: 車による移動時間の自動算出結果を表示した画面.
 #+attr_latex: :width 12cm
 file:./fig/car.png

これらの機能は,旅行の編集・調節を支援する上で不可欠な要素であり,ユーザーが旅程全体の流れを把握しながら,日程ごとの詳細な計画を直感的に調整できる環境を提供している.


*** 検索機能
旅行データの登録・閲覧・編集を効率的かつ直感的に行えるよう,2つの検索機能を実装した.

旅行一覧画面に多くの旅行が表示されている場合,目的の旅行を探し出すのに時間がかかることがある.
そこで,図3.15のように旅行名や説明欄に含まれる単語をもとに部分一致によるキーワード検索を行い,該当するデータを絞り込めるようにした.
いずれの検索においても,大文字・小文字を区別しない部分一致検索を実現しているため,ユーザーは入力時に文字の大小を意識する必要がない.
そのため,検索漏れを防ぐことができ,よりスムーズに目的のデータへアクセスできるようになった.
また,検索結果の件数を取得し,「○件」という形式で表示することで,検索結果の量を一目で把握できるようにした.

 #+CAPTION: 検索結果画面.
 #+attr_latex: :width 12cm
 file:./fig/search_results.png

観光地の登録機能においては,MapboxのSearch Box API[7]を活用した地名検索機能を導入した.
施設名の入力画面は図3.16である.
これにより,ユーザーは住所だけでなく,観光地名やカテゴリ,通り名などを入力することで,目的の場所を効率的に検索できるようになった.

以前は完全無料であるOpenStreetMapのNominatimを利用していたが,目的の観光地が検索にヒットしにくいという課題があった.そこで,MapboxのSearch Box APIへの切り替えにより,検索精度が向上し,より多くの地名を正確に取得できるようになったことで,ユーザー体験の向上につながった.

また,MapboxのSearch Box APIは月10万回まで無料で利用できるため,コスト面でも導入しやすいという利点がある.
 #+CAPTION: 施設名の入力画面.
 #+attr_latex: :width 12cm
 file:./fig/search_place.png


*** チェックリスト機能
旅行準備を効率的に進められるよう,チェックリストに関する複数の機能を実装した.
まず,図3.17のように旅行ごとに標準のチェックリスト設定を適用できる機能を導入した.
これにより,ユーザーは毎回ゼロからリストを作成する必要がなく,あらかじめ用意された基本項目をもとに効率よく準備を開始できるようになった.
さらに,基本項目をテンプレート化することで,今回だけ書き忘れたという漏れを防ぐ効果も期待できる.

 #+CAPTION: チェックリスト設定画面.
 #+attr_latex: :width 12cm
 file:./fig/checklist_setting.png

また,各旅行ごとに持ち物や準備項目を自由に編集できるチェックリスト編集機能を導入した.
これにより,ユーザーは旅行の目的や季節,同行者に応じて,図3.18のように必要な項目を柔軟に追加することも可能となった.
状況に応じたカスタマイズが行えることで,より実際のニーズに即した準備ができるようになり,忘れ物や準備漏れの防止にもつながる.
 #+CAPTION: チェックリスト追加画面.
 #+attr_latex: :width 10cm
 file:./fig/add_checklist.png

さらに,図3.19に示したとおり,各項目のチェック状況を保持する機能を実装し,ユーザーが確認済みの持ち物を記録できるようにした.
これにより,準備の進捗状況を可視化しながら,持ち物の確認状況を一目で把握できるようになり,確認漏れや二重確認の負担を軽減することが可能となった.
チェックの状態は旅行ごとに保存されるため,複数の旅行を並行して準備する場合でも, 各旅程の進捗を個別に管理できる.
#+CAPTION: チェックリストの管理画面.
 #+attr_latex: :width 10cm
 file:./fig/checklist_maintenance.png
これらの機能は,旅行前の準備を支援する上で重要な役割を果たしており,ユーザーが安心して出発できるよう,
実用性と柔軟性を兼ね備えたチェックリスト管理環境を提供している.


* まとめ

本研究では，pythonで書かれたサーバー側WebアプリケーションフレームワークであるDjangoを開発環境として，
視覚的な理解と効率的に旅行計画を行えるデジタル版しおりを開発した.

開発手法としては,機能ごとに優先順位を設定し,重要度の高いものから順に実装を進めることで,ユーザーに対して価値を早期に提供することを重視した.
このアプローチにより,開発初期から研究室内での試用とフィードバックが可能となり,得られた意見を反映しながら,より実用性と完成度の高いグループウェアアプリへと発展させることができた.

機能面では地図の表示や色分け機能によって旅行全体の構成を視覚的に把握しやすくし，キーワード検索機能や地名検索機能により，目的地の絞り込みやデータの整理を効率的に行えるようにした.また,Django の認証機能を活用してログイン機能を実装し,ユーザーごとのデータ管理やアクセス制御を可能にした.さらに，チェックリストや日程ごとのタブ表示，移動時間の自動算出といった機能を組み合わせることで，旅行前の準備から当日の行動管理，旅行後の振り返りまでを一貫してサポートできる設計とした.

結果として，旅行計画を可視化し，ユーザーが直感的に全体像を把握できるアプリケーションを開発することができた.
